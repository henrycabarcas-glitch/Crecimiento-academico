{
  "entities": {
    "Student": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Student",
      "type": "object",
      "description": "Represents a student in the school, with fields aligned with SIMAT requirements.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Student entity."
        },
        "photoUrl": {
            "type": "string",
            "description": "URL of the student's profile picture.",
            "format": "uri"
        },
        "documentType": {
          "type": "string",
          "description": "Type of identity document (e.g., 'Registro Civil', 'Tarjeta de Identidad')."
        },
        "documentNumber": {
          "type": "string",
          "description": "The student's identity document number."
        },
        "expeditionCountry": {
          "type": "string",
          "description": "Country where the identity document was issued."
        },
        "expeditionDepartment": {
          "type": "string",
          "description": "Department where the identity document was issued."
        },
        "expeditionMunicipality": {
          "type": "string",
          "description": "Municipality where the identity document was issued."
        },
        "firstName": {
          "type": "string",
          "description": "Student's first name."
        },
        "lastName": {
          "type": "string",
          "description": "Student's last name."
        },
        "dateOfBirth": {
          "type": "string",
          "description": "Student's date of birth.",
          "format": "date"
        },
        "birthCountry": {
          "type": "string",
          "description": "Country where the student was born."
        },
        "birthDepartment": {
          "type": "string",
          "description": "Department where the student was born."
        },
        "birthMunicipality": {
          "type": "string",
          "description": "Municipality where the student was born."
        },
        "gender": {
          "type": "string",
          "description": "The student's gender (e.g., 'Masculino', 'Femenino')."
        },
        "gradeLevel": {
          "type": "string",
          "description": "The grade level the student is enrolling in (e.g., 'Jardin', 'Transicion', '1')."
        },
        "enrollmentDate": {
          "type": "string",
          "description": "Date when the student was enrolled.",
          "format": "date"
        },
        "previousInstitution": {
            "type": "string",
            "description": "Name of the previous educational institution, if applicable."
        },
        "academicSituation": {
            "type": "string",
            "description": "Academic situation from the previous year (e.g., 'Aprobado', 'Reprobado')."
        },
        "parentIds": {
          "type": "array",
          "description": "References to Parents. (Relationship: Student 1:N Parent)",
          "items": {
            "type": "string"
          }
        },
        "address": {
          "type": "string",
          "description": "Student's residence address."
        },
        "residentialZone": {
            "type": "string",
            "description": "Zone of residence (e.g., 'Urbana', 'Rural')."
        },
        "phoneNumber": {
          "type": "string",
          "description": "Student's contact phone number."
        },
        "socioeconomicStratum": {
            "type": "string",
            "description": "Socioeconomic stratum of the student's residence."
        },
        "sisbenScore": {
            "type": "string",
            "description": "SISBEN score or classification group."
        },
        "healthProvider": {
            "type": "string",
            "description": "Name of the student's health provider (EPS)."
        },
        "healthCenter": {
            "type": "string",
            "description": "Name of the primary health center (IPS)."
        },
        "bloodType": {
            "type": "string",
            "description": "Student's blood type (e.g., 'O+')."
        },
        "disability": {
            "type": "string",
            "description": "Specifies any disability or special educational need."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "documentType",
        "documentNumber",
        "dateOfBirth",
        "gender",
        "gradeLevel",
        "enrollmentDate"
      ]
    },
    "Teacher": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Teacher",
      "type": "object",
      "description": "Represents a teacher in the school.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Teacher entity."
        },
        "firstName": {
          "type": "string",
          "description": "Teacher's first name."
        },
        "lastName": {
          "type": "string",
          "description": "Teacher's last name."
        },
        "email": {
          "type": "string",
          "description": "Teacher's email address.",
          "format": "email"
        },
        "phoneNumber": {
          "type": "string",
          "description": "Teacher's phone number."
        },
        "courseIds": {
          "type": "array",
          "description": "References to Courses. (Relationship: Teacher 1:N Course)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email"
      ]
    },
    "Course": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Course",
      "type": "object",
      "description": "Represents a course or subject.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Course entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the course (e.g., 'Mathematics', 'Science')."
        },
        "description": {
          "type": "string",
          "description": "Description of the course content."
        },
        "teacherId": {
          "type": "string",
          "description": "Reference to Teacher. (Relationship: Teacher 1:N Course)"
        },
        "studentIds": {
          "type": "array",
          "description": "References to Students enrolled in the course. (Relationship: Course 1:N Student)",
          "items": {
            "type": "string"
          }
        },
        "gradeLevel": {
          "type": "string",
          "description": "The grade level this course is for."
        }
      },
      "required": [
        "id",
        "name",
        "teacherId",
        "gradeLevel"
      ]
    },
    "Parent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Parent",
      "type": "object",
      "description": "Represents a parent or guardian of a student.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Parent entity."
        },
        "firstName": {
          "type": "string",
          "description": "Parent's first name."
        },
        "lastName": {
          "type": "string",
          "description": "Parent's last name."
        },
        "email": {
          "type": "string",
          "description": "Parent's email address.",
          "format": "email"
        },
        "phoneNumber": {
          "type": "string",
          "description": "Parent's phone number."
        },
        "studentIds": {
          "type": "array",
          "description": "References to Students. (Relationship: Student 1:N Parent)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email"
      ]
    },
    "Achievement": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Achievement",
      "type": "object",
      "description": "Represents a learning achievement or goal for a course.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Achievement entity."
        },
        "courseId": {
          "type": "string",
          "description": "Reference to the Course this achievement belongs to."
        },
        "period": {
          "type": "string",
          "description": "The academic period this achievement is for (e.g., 'Trimestre 1')."
        },
        "description": {
          "type": "string",
          "description": "The text describing the achievement."
        },
        "gradeLevel": {
          "type": "string",
          "description": "The grade level this achievement is for."
        }
      },
      "required": [
        "id",
        "courseId",
        "period",
        "description",
        "gradeLevel"
      ]
    },
    "ReportCard": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ReportCard",
      "type": "object",
      "description": "Represents a student's report card for a specific period.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ReportCard entity."
        },
        "studentId": {
          "type": "string",
          "description": "Reference to Student. (Relationship: Student 1:N ReportCard)"
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Relationship: Course 1:N ReportCard)"
        },
        "period": {
          "type": "string",
          "description": "The academic period the report card is for (e.g., 'First Semester', 'Second Quarter')."
        },
        "grade": {
          "type": "number",
          "description": "The final grade for the course in this period."
        },
        "comments": {
          "type": "string",
          "description": "Teacher's comments on the student's performance."
        },
        "dateIssued": {
          "type": "string",
          "description": "Date when the report card was issued.",
          "format": "date"
        }
      },
      "required": [
        "id",
        "studentId",
        "courseId",
        "period",
        "grade"
      ]
    },
    "BehavioralObservation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "BehavioralObservation",
      "type": "object",
      "description": "Represents a record of a student's behavior.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the BehavioralObservation entity."
        },
        "studentId": {
          "type": "string",
          "description": "Reference to Student. (Relationship: Student 1:N BehavioralObservation)"
        },
        "date": {
          "type": "string",
          "description": "Date of the observation.",
          "format": "date"
        },
        "description": {
          "type": "string",
          "description": "Description of the behavior observed."
        },
        "type": {
          "type": "string",
          "description": "Type of behavior (e.g., 'Positive', 'Negative', 'Needs Improvement')."
        },
        "teacherId": {
          "type": "string",
          "description": "Reference to Teacher who made the observation. (Relationship: Teacher 1:N BehavioralObservation)"
        }
      },
      "required": [
        "id",
        "studentId",
        "date",
        "description",
        "type"
      ]
    },
    "Payment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Payment",
      "type": "object",
      "description": "Represents a payment made by a parent.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Payment entity."
        },
        "studentId": {
          "type": "string",
          "description": "Reference to Student. (Relationship: Student 1:N Payment)"
        },
        "date": {
          "type": "string",
          "description": "Date of the payment.",
          "format": "date"
        },
        "amount": {
          "type": "number",
          "description": "Amount paid."
        },
        "method": {
          "type": "string",
          "description": "Payment method (e.g., 'Cash', 'Credit Card', 'Bank Transfer')."
        },
        "receiptNumber": {
          "type": "string",
          "description": "Receipt number for the payment."
        }
      },
      "required": [
        "id",
        "studentId",
        "date",
        "amount",
        "method"
      ]
    },
    "SchoolSettings": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SchoolSettings",
      "type": "object",
      "description": "Represents the general settings of the school.",
      "properties": {
        "schoolName": {
          "type": "string",
          "description": "The name of the school."
        },
        "nit": {
            "type": "string",
            "description": "The school's NIT (Número de Identificación Tributaria)."
        },
        "resolutionMEN": {
            "type": "string",
            "description": "The school's MEN (Ministerio de Educación Nacional) resolution number."
        },
        "daneCode": {
            "type": "string",
            "description": "The school's DANE code."
        },
        "rectorName": {
          "type": "string",
          "description": "The name of the school's rector."
        },
        "phone": {
          "type": "string",
          "description": "The school's contact phone number."
        },
        "address": {
          "type": "string",
          "description": "The school's physical address."
        },
        "email": {
          "type": "string",
          "description": "The school's contact email address.",
          "format": "email"
        },
        "logoUrl": {
          "type": "string",
          "description": "URL for the school's logo.",
          "format": "uri"
        }
      },
      "required": [
        "schoolName"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/students/{studentId}",
        "definition": {
          "entityName": "Student",
          "schema": {
            "$ref": "#/backend/entities/Student"
          },
          "description": "Stores student data. Includes studentId as a parameter for document access. The parentIds array provides the necessary data to secure reads, writes, and updates, enforcing that only associated parents or authorized personnel can access student records.",
          "params": [
            {
              "name": "studentId",
              "description": "The unique identifier for the student."
            }
          ]
        }
      },
      {
        "path": "/teachers/{teacherId}",
        "definition": {
          "entityName": "Teacher",
          "schema": {
            "$ref": "#/backend/entities/Teacher"
          },
          "description": "Stores teacher data.  Includes teacherId as a parameter for document access. The courseIds array provides the necessary data to secure reads, writes, and updates, enforcing that only assigned courses or authorized personnel can access teacher records.",
          "params": [
            {
              "name": "teacherId",
              "description": "The unique identifier for the teacher."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}",
        "definition": {
          "entityName": "Course",
          "schema": {
            "$ref": "#/backend/entities/Course"
          },
          "description": "Stores course information. Includes courseId as a parameter for document access.  `teacherId` and `studentIds` fields are used for authorization rules.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier for the course."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}/achievements/{achievementId}",
        "definition": {
          "entityName": "Achievement",
          "schema": {
            "$ref": "#/backend/entities/Achievement"
          },
          "description": "Stores learning achievements for a specific course.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier for the course."
            },
            {
              "name": "achievementId",
              "description": "The unique identifier for the achievement."
            }
          ]
        }
      },
      {
        "path": "/parents/{parentId}",
        "definition": {
          "entityName": "Parent",
          "schema": {
            "$ref": "#/backend/entities/Parent"
          },
          "description": "Stores parent data. Includes parentId as a parameter for document access. The studentIds array provides the necessary data to secure reads, writes, and updates, enforcing that only associated students or authorized personnel can access parent records.",
          "params": [
            {
              "name": "parentId",
              "description": "The unique identifier for the parent."
            }
          ]
        }
      },
      {
        "path": "/students/{studentId}/reportCards/{reportCardId}",
        "definition": {
          "entityName": "ReportCard",
          "schema": {
            "$ref": "#/backend/entities/ReportCard"
          },
          "description": "Stores report cards for a specific student.  Includes studentId and reportCardId as parameters for document access.",
          "params": [
            {
              "name": "studentId",
              "description": "The unique identifier for the student."
            },
            {
              "name": "reportCardId",
              "description": "The unique identifier for the report card."
            }
          ]
        }
      },
      {
        "path": "/students/{studentId}/behavioralObservations/{behavioralObservationId}",
        "definition": {
          "entityName": "BehavioralObservation",
          "schema": {
            "$ref": "#/backend/entities/BehavioralObservation"
          },
          "description": "Stores behavioral observations for a specific student. Includes studentId and behavioralObservationId as parameters for document access.",
          "params": [
            {
              "name": "studentId",
              "description": "The unique identifier for the student."
            },
            {
              "name": "behavioralObservationId",
              "description": "The unique identifier for the behavioral observation."
            }
          ]
        }
      },
      {
        "path": "/students/{studentId}/payments/{paymentId}",
        "definition": {
          "entityName": "Payment",
          "schema": {
            "$ref": "#/backend/entities/Payment"
          },
          "description": "Stores payment information for a specific student. Includes studentId and paymentId as parameters for document access.",
          "params": [
            {
              "name": "studentId",
              "description": "The unique identifier for the student."
            },
            {
              "name": "paymentId",
              "description": "The unique identifier for the payment."
            }
          ]
        }
      },
      {
        "path": "/settings/{settingId}",
        "definition": {
          "entityName": "SchoolSettings",
          "schema": {
            "$ref": "#/backend/entities/SchoolSettings"
          },
          "description": "Stores general school settings. A single document can be used.",
          "params": [
            {
              "name": "settingId",
              "description": "The unique identifier for the settings document."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure is designed to support Scholarly Growth, a comprehensive educational management system for a Colombian school, focusing on compliance with the Ministry of Education's standards and Law 1581. The structure prioritizes security, scalability, and ease of use for administrators, teachers, and parents.\n\n**Authorization Independence:** Authorization independence is achieved through path-based ownership (e.g., `/users/{userId}/drafts`) for private data and the membership map model for collaborative data. Denormalization is used where needed to avoid `get()` calls in security rules, allowing atomic operations. For instance, if access to `ReportCards` depends on the student's grade level or course membership, this data is denormalized into the `ReportCard` document.\n\n**Structural Segregation:** The design enforces a homogeneous security posture by ensuring each collection contains documents with similar access requirements. Private user data resides under `/users/{userId}`, and collaborative data uses membership maps for access control.\n\n**Access Modeling:**\n*   **Path-Based Ownership:** User-specific data (e.g., a parent's profile or a teacher's courses) is stored under `/users/{userId}` to simplify ownership-based security rules.\n*   **Membership Maps:**  For collaborative entities, such as Courses where multiple students and teachers are involved, a `members` map (or similar) is used to define roles and permissions within the document.  Consider storing course-specific members within the course document or a subcollection, depending on frequency of access.\n*   **Global Roles (DBAC):**  Admin roles are managed using existence checks in dedicated collections like `/roles_admin/{uid}`, avoiding custom claims and improving security rule simplicity.\n\n**QAPs (Rules Are Not Filters):** The structure supports secure list operations. Path-based ownership and membership maps enable rules to efficiently determine if a user has access to a document without needing to filter based on document content.\n\n**Specific Collection Strategies:**\n\n*   **Students:** Stored in a flat `/students` collection. Parent relationships are managed through the `parentIds` array within each student document. Authorization is handled by checking if the accessing user's ID exists within the student's `parentIds` array.\n*   **Teachers:** Stored in a flat `/teachers` collection. Course assignments are managed via the `courseIds` array. Access is controlled by verifying the user's ID against the `teacherId` field in the course or related documents.\n*   **Courses:**  Stored in a flat `/courses` collection, with `teacherId` indicating the course's teacher. Student enrollment is tracked with `studentIds`. Security rules should ensure only the teacher, enrolled students, or admins can access course details.\n*   **Parents:** Stored in a flat `/parents` collection, with `studentIds` indicating associated students. Security is based on matching the user's ID against the `studentIds` of the requested student.\n*   **ReportCards, BehavioralObservations, and Payments:** These are stored as subcollections under the respective student document (`/students/{studentId}/reportCards`, etc.) to establish clear ownership and simplify security rules. This approach also supports easier data retrieval for a specific student.\n* **Achievements**: Stored as a subcollection under `/courses/{courseId}/achievements` to link them directly to a course. This simplifies authorization, as access can be derived from course ownership (teacherId).\n\n**School Settings**: A top-level `/settings` collection will hold a single document for global school settings. This allows administrators to manage school-wide information easily.\n\nThe structure ensures data clarity and predictability through explicit state modeling (using a `status` field where applicable), predictable schema with static keys, and standardized naming conventions. This design facilitates robust, secure, and easily maintainable Firestore rules that directly reflect the application's authorization logic."
  }
}

    